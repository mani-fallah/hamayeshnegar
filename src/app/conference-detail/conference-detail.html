<ng-container *ngIf="vm$ | async as vm">
  <!-- Loading -->
  <section *ngIf="vm.loading" class="page-body py-4">
    <div class="container">
      <div class="alert alert-info mb-0">در حال بارگذاری...</div>
    </div>
  </section>

  <!-- Error -->
  <section *ngIf="!vm.loading && vm.errorMsg" class="page-body py-4">
    <div class="container">
      <div class="alert alert-danger mb-0">{{ vm.errorMsg }}</div>
    </div>
  </section>

  <!-- Content -->
  <ng-container *ngIf="!vm.loading && !vm.errorMsg && vm.conference as c">
    <!-- Header gradient -->
    <div
      style="background: linear-gradient(90deg, rgba(17, 24, 39, .85), rgba(17, 24, 39, .35)); color: white; padding: 20px; flex-shrink: 0;"
    >
      <app-header></app-header>
    </div>

    <!-- HERO -->
    <section class="hero">
      <div class="hero-overlay"></div>
      <div class="container hero-inner">
        <h1 class="hero-title mb-2">
          {{ c.title }}
        </h1>

        <p class="hero-subtitle mb-0">
          {{ c.short_description || c.description }}
        </p>
      </div>
    </section>

    <!-- mini bar -->
    <section class="mini-bar">
      <div class="container d-flex flex-wrap gap-2 align-items-center justify-content-between">
        <div class="mini-item">
          <span class="mini-label">تاریخ شروع:</span>
          <span class="mini-value">{{ c.start_date }}</span>
        </div>

        <div class="mini-item">
          <span class="mini-label">تاریخ پایان:</span>
          <span class="mini-value">{{ c.end_date }}</span>
        </div>

        <a
          *ngIf="c.website"
          class="btn btn-sm btn-primary"
          [href]="c.website"
          target="_blank"
          rel="noopener"
        >
          وب‌سایت / ارسال مقاله
        </a>

        <button *ngIf="!c.website" class="btn btn-sm btn-primary" disabled>
          ارسال مقاله
        </button>
      </div>
    </section>

    <!-- body -->
    <section class="page-body py-4">
      <div class="container">
        <div class="row g-3">

          <!-- LEFT -->
          <aside class="col-12 col-lg-2 order-3 order-lg-1">
            <div class="row g-3">

              <!-- برگزارکنندگان -->
              <div class="col-6 col-lg-12">
                <div class="panel h-100">
                  <div class="panel-header">برگزارکنندگان</div>
                  <div class="panel-body logos">

                    <img class="img-fluid object-fit-cover w-100 rounded logo"
                         src="./madani.png"
                         alt="logo">


                  </div>
                </div>
              </div>

              <!-- حامیان -->
              <div class="col-6 col-lg-12">
                <div class="panel h-100">
                  <div class="panel-header">حامیان کنفرانس</div>
                  <div class="panel-body logos">
                    <img class="img-fluid object-fit-cover w-100 rounded logo"
                         src="./madani.png"
                         alt="logo">
                  </div>
                </div>
              </div>

            </div>
          </aside>

          <!-- RIGHT -->
          <aside class="col-12 col-lg-2 order-2 order-lg-3">
            <div class="row g-3">

              <!-- تاریخ‌های مهم -->
              <div class="col-6 col-lg-12">
                <div class="panel h-100">
                  <div class="panel-header">تاریخ‌های مهم</div>

                  <div class="panel-body important-dates">
                    <div class="date-row" *ngIf="c.submission_deadline">
                      <span>مهلت ارسال </span>
                      <span class="date-pill">{{ c.submission_deadline }}</span>
                    </div>

                    <div class="date-row" *ngIf="c.registration_deadline">
                      <span>مهلت ثبت‌نام</span>
                      <span class="date-pill">{{ c.registration_deadline }}</span>
                    </div>

                    <!-- اگر آرایه تاریخ‌های مهم دارید -->
                    <ng-container *ngIf="c.important_dates?.length">
                      <div class="date-row" *ngFor="let d of c.important_dates">
                        <span>{{ d?.title || d?.name || 'تاریخ مهم' }}</span>
                        <span class="date-pill">{{ d?.date || d?.value }}</span>
                      </div>
                    </ng-container>

                    <!-- fallback -->
                    <div *ngIf="!c.submission_deadline && !c.registration_deadline && !(c.important_dates?.length)"
                         class="text-muted small">
                      تاریخی ثبت نشده است.
                    </div>
                  </div>
                </div>
              </div>

              <!-- پوستر -->
              <div class="col-6 col-lg-12">
                <div class="panel h-100">
                  <div class="panel-header">پوستر کنفرانس</div>
                  <div class="panel-body">
                    <!-- اگر از API پوستر دارید -->
                    <img
                      *ngIf="c.poster"
                      class="img-fluid object-fit-cover w-100 rounded"
                      [src]="c.poster"
                      alt="poster"
                    />

                    <img
                      *ngIf="!c.poster"
                      class="img-fluid object-fit-cover w-100 rounded"
                      src="./confereence-bg.jpg"
                      alt="poster"
                    />
                  </div>
                </div>
              </div>

              <!--
              <div class="col-12">
                <div class="panel">
                  <div class="panel-header">ورود به سامانه</div>
                  <div class="panel-body">
                    <form class="vstack gap-2">
                      <input class="form-control form-control-sm" placeholder="نام کاربری">
                      <input class="form-control form-control-sm" placeholder="رمز عبور" type="password">
                      <button class="btn btn-primary btn-sm w-100" type="button">ورود / ثبت‌نام</button>
                      <a class="small text-decoration-none" href="#">رمز را فراموش کرده‌ام</a>
                    </form>
                  </div>
                </div>
              </div>
              -->

            </div>
          </aside>

          <!-- CENTER -->
          <main class="col-12 col-lg-8 order-1 order-lg-2">
            <div class="section-title">اخبار کنفرانس</div>

            <!-- اگر news از API دارید -->
            <ng-container *ngIf="c.news?.length; else noNews">
              <article class="news-card" *ngFor="let n of c.news">
                <div class="news-thumb"></div>

                <div class="news-content">
                  <h6 class="news-title">{{ n?.title || 'خبر' }}</h6>
                  <p class="news-text mb-2">
                    {{ n?.summary || n?.short_description || n?.text || '' }}
                  </p>

                  <div class="news-meta">
                    <span class="badge-soft">{{ n?.date || n?.created_at || '' }}</span>

                    <a
                      *ngIf="n?.link"
                      class="news-link"
                      [href]="n.link"
                      target="_blank"
                      rel="noopener"
                    >
                      ادامه مطلب
                    </a>

                    <span *ngIf="!n?.link" class="news-link text-muted">—</span>
                  </div>
                </div>
              </article>
            </ng-container>

            <ng-template #noNews>
              <div class="panel">
                <div class="panel-body text-muted">
                  خبری برای نمایش وجود ندارد.
                </div>
              </div>
            </ng-template>

            <!-- معرفی / توضیحات -->
            <div class="panel mt-3">
              <div class="panel-header">فراخوان و معرفی کنفرانس</div>
              <div class="panel-body">
                <p class="mb-0 text-muted">
                  {{ c.description }}
                </p>
              </div>
            </div>

            <!-- لینک‌های مهم -->
            <div class="panel mt-3">
              <div class="panel-header">لینک‌ها</div>
              <div class="panel-body d-flex flex-wrap gap-2">
                <a *ngIf="c.website" class="btn btn-sm btn-primary" [href]="c.website" target="_blank" rel="noopener">
                  وب‌سایت همایش
                </a>

                <a *ngIf="c.is_online && c.online_link" class="btn btn-sm btn-outline-primary" [href]="c.online_link"
                   target="_blank" rel="noopener">
                  لینک آنلاین
                </a>

                <a *ngIf="c.brochure" class="btn btn-sm btn-outline-secondary" [href]="c.brochure" target="_blank"
                   rel="noopener">
                  بروشور
                </a>

                <a *ngIf="c.proceedings_link" class="btn btn-sm btn-outline-secondary" [href]="c.proceedings_link"
                   target="_blank" rel="noopener">
                  مجموعه مقالات
                </a>

                <span *ngIf="!c.website && !(c.is_online && c.online_link) && !c.brochure && !c.proceedings_link"
                      class="text-muted small">
                  لینکی ثبت نشده است.
                </span>
              </div>
            </div>

            <!-- متا (اختیاری) -->
            <div class="panel mt-3">
              <div class="panel-header">اطلاعات</div>
              <div class="panel-body d-flex flex-wrap gap-2">
                <span class="badge bg-soft-secondary text-secondary">
  وضعیت:
  <span
    class="badge text-white"
    [ngClass]="{
      'bg-success': c.status === 'ongoing',
      'bg-warning': c.status === 'upcoming',
      'bg-danger': c.status === 'cancelled',
      'bg-secondary': !c.status
    }"
  >
    {{ c.status || '—' }}
  </span>
</span>


                <span class="badge bg-soft-secondary text-secondary">
                  نوع برگزاری: {{ c.is_online ? 'آنلاین' : 'حضوری' }}
                </span>

                <span class="badge bg-soft-secondary text-secondary" *ngIf="c.location">
                  مکان: {{ c.location }}
                </span>

                <span class="badge bg-soft-secondary text-secondary" *ngIf="c.address">
                  آدرس: {{ c.address }}
                </span>

                <span class="badge bg-soft-secondary text-secondary">
                  کارگاه‌ها: {{ c.workshops?.length ?? 0 }}
                </span>

                <span class="badge bg-soft-secondary text-secondary">
                  تاریخ‌های مهم: {{ c.important_dates?.length ?? 0 }}
                </span>
              </div>
            </div>

          </main>

        </div>
      </div>
    </section>
  </ng-container>
</ng-container>
